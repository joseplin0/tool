<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML+SVG è½¬å›¾ç‰‡å·¥å…·</title>
    <!-- å¼•å…¥Tailwind CSSï¼ˆç¨³å®šCDNç‰ˆæœ¬ï¼‰ -->
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <!-- æ ¸å¿ƒè½¬æ¢åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/dom-to-image@2.6.0/dist/dom-to-image.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <!-- ä»£ç é«˜äº® -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- ä»£ç æ ¼å¼åŒ– -->
    <script src="https://cdn.jsdelivr.net/npm/prettier@3.2.5/standalone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prettier@3.2.5/plugins/html.js"></script>
    <style>
      /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #999;
      }

      /* pre+code æ ·å¼ä¼˜åŒ– */
      .code-box {
        position: relative;
        height: 100%;
      }
      #htmlInput,
      #codePreview {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        font-family: monospace;
        font-size: 12px;
        line-height: 1.5;
        padding: 1rem;
        border-radius: 0.5rem;
      }
      #htmlInput {
        opacity: 0;
        z-index: 2;
        resize: none;
        border: 1px solid #e5e7eb;
      }
      #codePreview {
        opacity: 1;
        z-index: 1;
        pointer-events: none;
        background: #fff;
        border: 1px solid #e5e7eb;
        overflow: auto;
      }

      /* å…³é”®ä¿®å¤ï¼šé¢„è§ˆåŒºæ ·å¼ä¸è½¬æ¢ç¯å¢ƒä¸€è‡´ */
      #previewArea {
        background: #f9fafb; /* ä¸è½¬æ¢æ—¶çš„bgcolorä¸€è‡´ */
        color: #000; /* ç¡®ä¿currentColoræœ‰é»˜è®¤å€¼ */
      }
      /* ä¿®å¤SVGåœ¨é¢„è§ˆåŒºçš„é¢œè‰²ç»§æ‰¿é—®é¢˜ */
      #previewArea svg {
        stroke: inherit !important;
        fill: inherit !important;
      }
      /* é¢„è§ˆåŒºå†…å®¹å®¹å™¨é‡ç½®ï¼Œé¿å…æ ·å¼å¹²æ‰° */
      #previewContent {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen p-4 md:p-8">
    <div class="max-w-7xl mx-auto flex flex-col gap-6">
      <!-- æ ‡é¢˜åŒºåŸŸ -->
      <header class="text-center mb-4">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">
          HTML+SVG è½¬å›¾ç‰‡å·¥å…·
        </h1>
        <p class="text-gray-500 mt-2">
          æ”¯æŒå†…è”SVGã€Tailwind CSSçš„HTMLç‰‡æ®µè½¬æ¢ä¸ºPNG/JPGå›¾ç‰‡
        </p>
      </header>

      <!-- æ ¸å¿ƒåŠŸèƒ½åŒºï¼šå·¦å³åˆ†æ  -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- å·¦ä¾§ï¼šè¾“å…¥åŒºï¼ˆpre+code ç®€åŒ–ç‰ˆï¼‰ -->
        <div
          class="bg-white rounded-lg shadow-sm p-4 h-[600px] flex flex-col gap-4"
        >
          <h2 class="text-lg font-semibold text-gray-700">
            ğŸ“ HTML+SVG ä»£ç è¾“å…¥
          </h2>
          <div class="flex gap-2 mb-2 flex-wrap">
            <button
              id="previewBtn"
              class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition"
            >
              é¢„è§ˆä»£ç 
            </button>
            <button
              id="formatBtn"
              class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition"
            >
              æ ¼å¼åŒ–ä»£ç 
            </button>
            <button
              id="clearBtn"
              class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition"
            >
              æ¸…ç©º
            </button>
          </div>

          <!-- æ ¸å¿ƒï¼špre+code ä»£ç å±•ç¤º + textarea è¾“å…¥ -->
          <div class="code-box relative w-full h-full">
            <textarea
              id="htmlInput"
              placeholder="ç²˜è´´åŒ…å«SVGçš„HTMLä»£ç ï¼ˆæ”¯æŒTailwind CSSï¼‰..."
            ></textarea>
            <pre
              id="codePreview"
            ><code class="language-html" id="codeContent"></code></pre>
          </div>
        </div>

        <!-- å³ä¾§ï¼šé¢„è§ˆ+è¾“å‡ºåŒºï¼ˆé‡ç‚¹ä¿®å¤ï¼‰ -->
        <div
          class="bg-white rounded-lg shadow-sm p-4 h-[600px] flex flex-col gap-4"
        >
          <h2 class="text-lg font-semibold text-gray-700">ğŸ–¥ï¸ é¢„è§ˆ & è¾“å‡º</h2>

          <!-- é¢„è§ˆåŒºåŸŸï¼ˆä¿®å¤æ ·å¼ï¼‰ -->
          <div
            class="flex-1 border border-gray-300 rounded-lg p-0 bg-gray-50 overflow-auto"
            id="previewArea"
          >
            <!-- æ–°å¢å†…å®¹å®¹å™¨ï¼Œç»Ÿä¸€æ¸²æŸ“ä¸Šä¸‹æ–‡ -->
            <div id="previewContent" class="p-4">
              <div
                class="text-gray-500 text-center flex items-center justify-center h-full"
              >
                ç‚¹å‡»ã€Œé¢„è§ˆä»£ç ã€æŸ¥çœ‹æ•ˆæœ
              </div>
            </div>
          </div>

          <!-- è½¬æ¢æŒ‰é’® -->
          <div class="flex gap-3">
            <button
              id="convertPngBtn"
              class="flex-1 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"
            >
              è½¬æ¢ä¸º PNG
            </button>
            <button
              id="convertJpgBtn"
              class="flex-1 px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 transition"
            >
              è½¬æ¢ä¸º JPG
            </button>
          </div>

          <!-- è¾“å‡ºå›¾ç‰‡åŒºåŸŸ -->
          <div
            class="mt-2 border border-gray-300 rounded-lg p-4 bg-gray-50 min-h-[100px] flex items-center justify-center"
            id="outputArea"
          >
            <span class="text-gray-500">è½¬æ¢åçš„å›¾ç‰‡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</span>
          </div>

          <!-- ä¸‹è½½æŒ‰é’®ï¼ˆé»˜è®¤éšè—ï¼‰ -->
          <button
            id="downloadBtn"
            class="hidden w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition"
          >
            ä¸‹è½½å›¾ç‰‡
          </button>
        </div>
      </div>

      <!-- æ³¨æ„äº‹é¡¹ -->
      <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <h3 class="font-semibold text-yellow-800">âš ï¸ æ³¨æ„äº‹é¡¹</h3>
        <ul
          class="mt-2 text-yellow-700 list-disc list-inside space-y-1 text-sm"
        >
          <li>
            ä»…æ”¯æŒ<strong>å†…è”SVG</strong>ï¼ˆç›´æ¥å†™åœ¨HTMLä¸­çš„SVGï¼‰ï¼Œå¤–éƒ¨å¼•ç”¨çš„SVGå¯èƒ½æ— æ³•è½¬æ¢
          </li>
          <li>
            è½¬æ¢åçš„å›¾ç‰‡å°ºå¯¸ä¸é¢„è§ˆåŒºåŸŸå†…å®¹å°ºå¯¸ä¸€è‡´ï¼Œå¯è°ƒæ•´HTMLä»£ç ä¸­çš„å°ºå¯¸æ ·å¼
          </li>
          <li>SVGå·²å¼ºåˆ¶ç»§æ‰¿é¢œè‰²ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹`stroke`/`fill`å±æ€§</li>
          <li>å¤æ‚HTMLå¯èƒ½è½¬æ¢è€—æ—¶ç¨é•¿ï¼Œè¯·è€å¿ƒç­‰å¾…</li>
        </ul>
      </div>
    </div>

    <script>
      // æ ¸å¿ƒå…ƒç´ è·å–
      const htmlInput = document.getElementById("htmlInput");
      const codeContent = document.getElementById("codeContent");
      const previewArea = document.getElementById("previewArea");
      const previewContent = document.getElementById("previewContent"); // æ–°å¢å†…å®¹å®¹å™¨
      const outputArea = document.getElementById("outputArea");
      const previewBtn = document.getElementById("previewBtn");
      const formatBtn = document.getElementById("formatBtn");
      const clearBtn = document.getElementById("clearBtn");
      const convertPngBtn = document.getElementById("convertPngBtn");
      const convertJpgBtn = document.getElementById("convertJpgBtn");
      const downloadBtn = document.getElementById("downloadBtn");

      // é¢„è®¾ç¤ºä¾‹ä»£ç ï¼ˆä¿®å¤SVGé¢œè‰²ï¼Œæ›¿æ¢currentColorä¸ºå…·ä½“å€¼ï¼‰
      const defaultCode = `<!-- é¢„è®¾ç¤ºä¾‹ä»£ç  -->
<div class="flex flex-col gap-8 p-8">
  <!-- Layer 1: Cloud/Core -->
  <div class="flex items-center justify-center gap-8">
    <div class="flex flex-col items-center gap-2">
      <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center">
        <svg class="w-8 h-8" fill="none" stroke="#2563eb" viewBox="0 0 24 24">
          <path 
            stroke-linecap="round" 
            stroke-linejoin="round" 
            stroke-width="2" 
            d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"
          ></path>
        </svg>
      </div>
      <span class="text-xs font-medium">è¿è¥å•†æ ¸å¿ƒç½‘</span>
    </div>
    <div class="w-16 h-px bg-gray-300"></div>
    <div class="flex flex-col items-center gap-2">
      <div class="w-16 h-16 bg-indigo-100 rounded-xl flex items-center justify-center">
        <svg class="w-8 h-8" fill="none" stroke="#4f46e5" viewBox="0 0 24 24">
          <path 
            stroke-linecap="round" 
            stroke-linejoin="round" 
            stroke-width="2" 
            d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"
          ></path>
        </svg>
      </div>
      <span class="text-xs font-medium">5Gæ ¸å¿ƒç½‘(5GC)</span>
    </div>
  </div>
</div>`;

      // åˆå§‹åŒ–ï¼šè®¾ç½®é»˜è®¤ä»£ç  + åŒæ­¥åˆ°pre+code
      htmlInput.value = defaultCode;
      syncCode();

      // 1. åŒæ­¥textareaå†…å®¹åˆ°pre+codeå¹¶é«˜äº®
      function syncCode() {
        codeContent.textContent = htmlInput.value;
        hljs.highlightElement(codeContent);
      }

      // 2. æ ¼å¼åŒ–ä»£ç 
      function formatHtmlCode() {
        try {
          const unformatted = htmlInput.value.trim();
          if (!unformatted) return;

          const formatted = prettier.format(unformatted, {
            parser: "html",
            htmlWhitespaceSensitivity: "ignore",
            tabWidth: 2,
            useTabs: false,
            printWidth: 100,
          });

          htmlInput.value = formatted;
          syncCode();
        } catch (e) {
          alert(`æ ¼å¼åŒ–å¤±è´¥ï¼š${e.message}`);
        }
      }

      // 3. ç»‘å®šäº‹ä»¶
      // è¾“å…¥åŒæ­¥
      htmlInput.addEventListener("input", syncCode);
      // æ ¼å¼åŒ–æŒ‰é’®
      formatBtn.addEventListener("click", formatHtmlCode);
      // é¢„è§ˆä»£ç ï¼ˆæ ¸å¿ƒä¿®å¤ï¼šæ¸²æŸ“åˆ°ç‹¬ç«‹å®¹å™¨ï¼Œä¿è¯æ ·å¼ä¸Šä¸‹æ–‡ï¼‰
      previewBtn.addEventListener("click", () => {
        try {
          const inputCode = htmlInput.value.trim();
          // æ¸²æŸ“åˆ°ç‹¬ç«‹çš„å†…å®¹å®¹å™¨ï¼Œé¿å…é¢„è§ˆåŒºæ ·å¼å¹²æ‰°
          previewContent.innerHTML =
            inputCode ||
            '<div class="text-gray-500 text-center">æ— é¢„è§ˆå†…å®¹</div>';

          // å¼ºåˆ¶é‡ç»˜é¢„è§ˆåŒºï¼Œç¡®ä¿æ ·å¼ç”Ÿæ•ˆ
          previewArea.style.display = "none";
          previewArea.offsetHeight; // è§¦å‘é‡ç»˜
          previewArea.style.display = "block";
        } catch (e) {
          previewContent.innerHTML = `<div class="text-red-500 text-center">é¢„è§ˆå¤±è´¥ï¼š${e.message}</div>`;
          console.error("é¢„è§ˆé”™è¯¯è¯¦æƒ…ï¼š", e);
        }
      });
      // æ¸…ç©º
      clearBtn.addEventListener("click", () => {
        htmlInput.value = "";
        syncCode();
        previewContent.innerHTML =
          '<div class="text-gray-500 text-center flex items-center justify-center h-full">ç‚¹å‡»ã€Œé¢„è§ˆä»£ç ã€æŸ¥çœ‹æ•ˆæœ</div>';
        outputArea.innerHTML =
          '<span class="text-gray-500">è½¬æ¢åçš„å›¾ç‰‡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</span>';
        downloadBtn.classList.add("hidden");
      });

      // 4. è½¬æ¢å›¾ç‰‡ï¼ˆä¿®æ”¹ç›®æ ‡èŠ‚ç‚¹ä¸ºpreviewContentï¼Œä¸é¢„è§ˆä¸€è‡´ï¼‰
      async function convertToImage(format = "png") {
        try {
          convertPngBtn.disabled = true;
          convertJpgBtn.disabled = true;
          outputArea.innerHTML =
            '<div class="text-gray-500">æ­£åœ¨è½¬æ¢ï¼Œè¯·ç¨å€™...</div>';

          // å…³é”®ï¼šè½¬æ¢previewContentï¼ˆé¢„è§ˆçš„å®é™…å†…å®¹ï¼‰ï¼Œè€ŒépreviewArea
          const targetNode = previewContent;
          let imageUrl;
          if (format === "png") {
            imageUrl = await domtoimage.toPng(targetNode, {
              quality: 1.0,
              bgcolor: "#f9fafb",
            });
          } else {
            imageUrl = await domtoimage.toJpeg(targetNode, {
              quality: 0.95,
              bgcolor: "#f9fafb",
            });
          }

          outputArea.innerHTML = `<img src="${imageUrl}" alt="è½¬æ¢åçš„å›¾ç‰‡" class="max-w-full max-h-[300px] object-contain" />`;
          downloadBtn.dataset.imageUrl = imageUrl;
          downloadBtn.dataset.format = format;
          downloadBtn.classList.remove("hidden");
        } catch (e) {
          outputArea.innerHTML = `<div class="text-red-500">è½¬æ¢å¤±è´¥ï¼š${e.message}</div>`;
          console.error("è½¬æ¢é”™è¯¯è¯¦æƒ…ï¼š", e);
        } finally {
          convertPngBtn.disabled = false;
          convertJpgBtn.disabled = false;
        }
      }

      // è½¬æ¢æŒ‰é’®ç»‘å®š
      convertPngBtn.addEventListener("click", () => convertToImage("png"));
      convertJpgBtn.addEventListener("click", () => convertToImage("jpg"));

      // ä¸‹è½½å›¾ç‰‡
      downloadBtn.addEventListener("click", () => {
        const imageUrl = downloadBtn.dataset.imageUrl;
        const format = downloadBtn.dataset.format;
        if (!imageUrl) return;

        const link = document.createElement("a");
        link.href = imageUrl;
        link.download = `html-svg-converted-${new Date().getTime()}.${format}`;
        link.click();
        URL.revokeObjectURL(link.href);
      });

      // åˆå§‹åŒ–é¢„è§ˆ
      window.addEventListener("load", () => {
        previewBtn.click();
      });
    </script>
  </body>
</html>
